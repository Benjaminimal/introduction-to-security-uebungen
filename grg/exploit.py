#!/usr/bin/env python3

from requests import Session
from base64 import urlsafe_b64encode, urlsafe_b64decode
from operator import xor

import sys
import re


COOKIE_CIPHER = "C-37g56JmOANzMc8wMspBhoLae2wcPEkPO74TJe0kPmovVwC1SN7dVNVgsd0hURzyb6RklkDqemGgdb5_FrnhLQISPu7w7__DLDtQZZfRDW9kArEJr8YvZ5LfMpPtM6WuHRD9VsqfnAnsN7KqlQk1ndFKk1mpn5qEyktQP-I8O0="
BASE_URL = 'http://grg.wutctf.space/'
TARGET_URL = BASE_URL + '/uyulala'
SESSION = Session()


def get_flag(cookie):
    SESSION.cookies.set('session', cookie)
    res = SESSION.get(TARGET_URL)
    for line in res.text.split('\n'):
        if re.search(r'dark-panel', line) and not re.search(r'(Malformed|Descryption|Invalid|Session)', line):
            return line
    return None

def main():
    for idx, bite in enumerate(urlsafe_b64decode(COOKIE_CIPHER)):
        cookie = bytearray(urlsafe_b64decode(COOKIE_CIPHER))
        for guess in range(256):
            cookie[idx] = guess
            payload = str(urlsafe_b64encode(cookie))
            payload = payload[2:len(payload)-1]
            flag = get_flag(payload)
            if flag:
                print("Cookie: session={}\nFlag: {}".format(payload, flag))
                sys.exit()


if __name__ == '__main__':
    main()
